<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>吉利学院劳动教育平台</title>
    <link rel="shortcut icon" href="../static/img/head2.png" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="../static/css/task.css">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="../static/layui/css/layui.css" media="all">
</head>
<body>
<div class="layui-layout layui-layout-admin">
    <div class="layui-header" id="headername">
        <ul class="layui-nav ">
            <li class="layui-nav-item"><a href="task_list.html">首页</a></li>
            <li class="layui-nav-item layui-this"><a href="SocialPracticeForm.html">社会实践登记表</a></li>
        </ul>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item">
                <a href="javascript:;">
                    <img src="../static/img/head.png" class="layui-nav-img">
                    {{user.userName}}
                </a>

            </li>
            <li class="layui-nav-item"><a href="login.html">退出</a></li>
        </ul>
    </div>
</div>

<div class="con" style="margin-top: 70px;">
    <form class="layui-form layui-form-pane">
        <div class="layui-row">
            <div class="layui-col-md3">
                <div class="layui-form-item">
                    <label class="layui-form-label">本科类型</label>
                    <div class="layui-input-block">
                        <input type="text" name="undergraduateType" autocomplete="off" class="layui-input" id="type">
                    </div>
                </div>
            </div>
            <div class="layui-col-md3">
                <div class="layui-form-item">
                    <label class="layui-form-label">专业</label>
                    <div class="layui-input-block">
                        <input type="text" name="undergraduateType" autocomplete="off" class="layui-input" id="major">
                    </div>
                </div>
            </div>
            <div class="layui-col-md3">
                <div class="layui-form-item">
                    <label class="layui-form-label">政治面貌</label>
                    <div class="layui-input-block">
                        <input type="text" name="undergraduateType" autocomplete="off" class="layui-input" id="politics">
                    </div>
                </div>
            </div>
            <div class="layui-col-md3">
                <div class="layui-form-item">
                    <label class="layui-form-label">姓名</label>
                    <div class="layui-input-block">
                        <input type="text" name="reg_name" autocomplete="off" class="layui-input" id="regName">
                    </div>
                </div>
            </div>
            <div class="layui-col-md12">
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width: 120px">社会实践时间</label>
                    <div class="layui-input-block" style="margin-left: 120px;">
                        <input type="text" name="undergraduateType" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width: 120px">社会实践形式</label>
                    <div class="layui-input-block" style="margin-left: 120px;">
                        <input type="text" name="undergraduateType" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-form-item">
                    <label class="layui-form-label">指导老师</label>
                    <div class="layui-input-block">
                        <input type="text" name="undergraduateType" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width: 120px">社会实践项目</label>
                    <div class="layui-input-block" style="margin-left: 120px;">
                        <input type="text" name="undergraduateType" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width: 200px">社会实践单位（或对象）</label>
                    <div class="layui-input-block" style="margin-left: 200px;">
                        <input type="text" name="undergraduateType" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width: 120px">社会实践地址</label>
                    <div class="layui-input-block" style="margin-left: 120px;">
                        <input type="text" name="undergraduateType" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width: 200px">社会实践单位属性</label>
                    <div class="layui-input-block" style="margin-left: 200px;">
                        <input type="text" name="undergraduateType" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width: 120px">单位负责人</label>
                    <div class="layui-input-block" style="margin-left: 120px;">
                        <input type="text" name="undergraduateType" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width: 200px">对象调查联系方式</label>
                    <div class="layui-input-block" style="margin-left: 200px;">
                        <input type="text" name="undergraduateType" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width: 120px">电子邮箱</label>
                    <div class="layui-input-block" style="margin-left: 120px;">
                        <input type="text" name="undergraduateType" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width: 200px">主要产品（或事项）</label>
                    <div class="layui-input-block" style="margin-left: 200px;">
                        <input type="text" name="undergraduateType" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width: 120px">产值或现状</label>
                    <div class="layui-input-block" style="margin-left: 120px;">
                        <input type="text" name="undergraduateType" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width: 200px">人员需求（或专业方向）</label>
                    <div class="layui-input-block" style="margin-left: 200px;">
                        <input type="text" name="undergraduateType" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">实践单位或调查对象简介：</label>
                    <div class="layui-input-block">
                        <textarea placeholder="请输入内容" class="layui-textarea"></textarea>
                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">实践单位或调查对象评价：</label>
                    <div class="layui-input-block">
                        <textarea placeholder="请输入内容" class="layui-textarea"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-form-item" style="text-align: center">
            <div class="layui-row">
                <div class="layui-col-md4">
                    <button style="margin-left: 300px" class="layui-btn" lay-submit lay-filter="demo2" id="demo2">提交</button>
                </div>
                <div class="layui-col-md4">
                    <button class="layui-btn" lay-submit lay-filter="demo3" id="demo3">保存</button>
                </div>
                <div class="layui-col-md4">
                    <button type="reset" style="margin-left: -300px" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </div>
    </form>

</div>
<!-- 请勿在项目正式环境中引用该 layui.js 地址 -->
<script src="../static/layui/layui.js" charset="utf-8"></script>
<script src="../static/js/jquery.min.js"></script>
<script src="../static/js/axios-0.18.0.js"></script>
<script src="../static/js/vue.js"></script>
<script src="../static/element-ui/package/lib/index.js"></script>
<link rel="stylesheet" href="../static/element-ui/package/lib/theme-chalk/index.css">
<link rel="stylesheet" type="text/css" href="../static/css/task_detail.css">
<script>
    var data = {};
    let xhr1 = new XMLHttpRequest();
    xhr1.open('GET', '/users/session/1', true);
    xhr1.onreadystatechange = function() {
        if (xhr1.readyState === 4 && xhr1.status === 200) {
            data = JSON.parse(xhr1.responseText);
            console.log(data)
            document.getElementById("type").value = data.data.type
            document.getElementById("major").value = data.data.major
            document.getElementById("politics").value = data.data.politics
            document.getElementById("regName").value = data.data.regName
        }
    }
    xhr1.send();
</script>
<script>
    // 确认按钮数据提交
    layui.use(['jquery', 'form'], function () {
        var form = layui.form;
        var layer = layui.layer;
        // 提交事件
        layui.$('#demo2').on('click', function () {
            alert("确认按钮")
            let log = {};
            alert("数据创建成功")
            var data = {};
            let xhr1 = new XMLHttpRequest();
            xhr1.open('GET', '/users/session/1', true);
            xhr1.onreadystatechange = function() {
                if (xhr1.readyState === 4 && xhr1.status === 200) {
                    data = JSON.parse(xhr1.responseText);
                    console.log(data)
                    let table = document.getElementById('demo1');
                    log.type = data.data.type
                    log.major = data.data.major
                    log.politics = data.data.politics
                    log.regName = data.data.regName
                    log.location = document.getElementById("location").value;
                    log.logProcess = document.getElementById("logProcess").value;
                    log.effect = document.getElementById("effect").value;
                    log.result = document.getElementById("result").value;
                    log.logTime = document.getElementById("ID-laydate-shortcut-date").value;
                    log.logState = 3;
                    // 获取用户id
                    let userId = data.data.userId;
                    log.userId = userId;
                    console.log('log中user-id为' + userId)
                    alert("log数据添加完成")
                    axios({
                        method: 'post',
                        url: '/logs/insert',
                        data: JSON.stringify(log),
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    }).then(function (response) {
                        console.log(response.data);
                        alert('成功连接到接口insert');
                        // 解析后端返回的数据
                        try {
                            var jsonData = JSON.parse(response.data);
                            console.log(jsonData);
                        } catch (error) {
                            console.error('解析后端返回的数据失败:', error);
                            alert('解析后端返回的数据失败');
                        }
                    }).catch(function (error) {
                        console.error(error);
                        alert('链接失败' + error)
                    });
                }
            }
            xhr1.send();
        });
    });
</script>
<script>
    layui.use(['jquery', 'form'], function () {
        var form = layui.form;
        var layer = layui.layer;
        // 提交事件
        layui.$('#demo3').on('click', function () {
            let log = {};
            var data = {};
            let xhr1 = new XMLHttpRequest();
            xhr1.open('GET', '/users/session/1', true);
            xhr1.onreadystatechange = function() {
                if (xhr1.readyState === 4 && xhr1.status === 200) {
                    data = JSON.parse(xhr1.responseText);
                    console.log(data)

                    // 保存按钮被点击后的逻辑
                    log.userType = 1;
                    log.logClasses = document.getElementById("logClasses").value;
                    log.logType = 1;
                    log.logContent = document.getElementById("logContent").value;
                    log.location = document.getElementById("location").value;
                    log.logProcess = document.getElementById("logProcess").value;
                    log.effect = document.getElementById("effect").value;
                    log.result = document.getElementById("result").value;
                    log.logTime = document.getElementById("ID-laydate-shortcut-date").value;
                    log.logState = 4;
                    let userId = data.data.userId;
                    log.userId = userId;
                    console.log('log中user-id为' + userId)

                    axios({
                        method: 'post',
                        url: '/logs/insert',
                        data: JSON.stringify(log),
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    }).then(function (response) {
                        console.log(response.data);
                        alert('成功连接到接口insert');
                        // 解析后端返回的数据
                        try {
                            var jsonData = JSON.parse(response.data);
                            console.log(jsonData);
                            // 回显数据到表单控件
                            document.getElementById("logClasses").value = jsonData.logClasses;
                            document.getElementById("logContent").value = jsonData.logContent;
                            document.getElementById("location").value = jsonData.location;
                            // 其他控件同理
                        } catch (error) {
                            console.error('解析后端返回的数据失败:', error);
                            alert('解析后端返回的数据失败');
                        }
                        // 以下是需要添加的代码
                        document.cookie = "saveSuccess=true";  // 存储保存成功的提示信息到cookie中
                        window.location.reload();  // 刷新页面
                    }).catch(function (error) {
                        console.error(error);
                        alert('链接失败' + error)
                    });
                }
            }
            xhr1.send();
        });
    });

    // 需要添加的代码
    document.addEventListener("DOMContentLoaded", function(event) {
        var cookieArr = document.cookie.split(";");  // 获取所有cookie
        var saveSuccess = false;
        for (var i = 0; i < cookieArr.length; i++) {
            var cookiePair = cookieArr[i].split("=");
            var cookieName = cookiePair[0].trim();
            var cookieValue = cookiePair[1].trim();
            if (cookieName === "saveSuccess" && cookieValue === "true") {
                saveSuccess = true;
                break;
            }
        }
        if (saveSuccess) {
            alert("保存成功");  // 显示保存成功的提示信息
            document.cookie = "saveSuccess=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";  // 清除cookie
        }
    });
</script>


<script>
    let userName = new Vue({
        el: "#headername",
        data(){
            return{
                user:{
                    userName:'测试',
                },
            }
        },
        mounted(){
            //当页面加载完成后来发送异步请求获取数据
            var _this = this;
            axios({
                method:"get",
                url:"/users/session/1",
            }).then(function (resp){
                _this.user = resp.data;
                console.log(_this.user)
            })
        },
    })


</script>
</body>
</html>